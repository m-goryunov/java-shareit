CREATE SCHEMA IF NOT EXISTS "PUBLIC";

DROP TABLE IF EXISTS USERS, REQUESTS, ITEMS, COMMENTS, BOOKINGS;

CREATE TABLE IF NOT EXISTS USERS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME VARCHAR(255) NOT NULL,
    EMAIL VARCHAR(512) UNIQUE NOT NULL,
    CONSTRAINT PK_USER PRIMARY KEY (ID),
    CONSTRAINT UQ_USER_EMAIL UNIQUE (EMAIL)
);

CREATE TABLE IF NOT EXISTS REQUESTS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    DESCRIPTION VARCHAR(512) NOT NULL,
    REQUESTOR_ID BIGINT NOT NULL,
    CREATED TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT PK_REQUEST PRIMARY KEY (ID),
    CONSTRAINT FK_REQ_ID FOREIGN KEY (REQUESTOR_ID) REFERENCES USERS(ID)
);

CREATE TABLE IF NOT EXISTS ITEMS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    NAME VARCHAR(255) NOT NULL,
    DESCRIPTION VARCHAR(512) NOT NULL,
    IS_AVAILABLE BOOLEAN NOT NULL,
    OWNER_ID BIGINT NOT NULL,
    REQUEST_ID BIGINT,
    CONSTRAINT PK_ITEM PRIMARY KEY (ID),
    CONSTRAINT FK_USER_ID FOREIGN KEY (OWNER_ID) REFERENCES USERS (ID),
    CONSTRAINT FK_REQ_ID FOREIGN KEY (REQUEST_ID) REFERENCES REQUESTS (ID)
);

CREATE TABLE IF NOT EXISTS BOOKINGS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    START_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    END_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    ITEM_ID BIGINT NOT NULL,
    BOOKER_ID BIGINT NOT NULL,
    STATUS VARCHAR,
    CONSTRAINT PK_BOOKING PRIMARY KEY (ID),
    CONSTRAINT FK_ITEM_ID FOREIGN KEY (ITEM_ID) REFERENCES ITEMS(ID),
    CONSTRAINT FK_BOOKER_ID FOREIGN KEY (BOOKER_ID) REFERENCES USERS(ID)
);

CREATE TABLE IF NOT EXISTS COMMENTS
(
    ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    TEXT VARCHAR NOT NULL,
    ITEM_ID BIGINT NOT NULL,
    AUTHOR_ID BIGINT NOT NULL,
    CONSTRAINT PK_COMMENT PRIMARY KEY (ID),
    CONSTRAINT FK_ITEM FOREIGN KEY (ITEM_ID) REFERENCES ITEMS(ID),
    CONSTRAINT FK_AUTHOR FOREIGN KEY (AUTHOR_ID) REFERENCES USERS(ID)
);